{% if page.usetocbot %} 
    <!-- tocbot is an awesome table of contents generator, see: https://tscanlin.github.io/tocbot/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>

    <script>
      /* Dynamically add the toc navbar after the side-bar element. This allows us
         to *not* have to override default.html in _layouts */
      let sideBarElements = document.getElementsByClassName('side-bar');
      if (sideBarElements.length > 0){
        let tocNav = document.createElement('nav');
        tocNav.setAttribute("id", "tocbot-toc");
        tocNav.classList.add("js-toc");
        tocNav.classList.add("tocbot-right");
        sideBarElements[0].after(tocNav);
      }

      /** WARNING: YOU MUST USE C MULTI-LINE COMMENT STYLE RATHER THAN // BECAUSE 
       *  OF HOW JEKYLL COMPILES THIS FILE INTO SINGLE LINES **/
      tocbot.init({
        /* Where to render the table of contents. */
        tocSelector: '.js-toc',
        /* Where to grab the headings to build the table of contents. */
        contentSelector: '.main-content',
        /* How many heading levels should collapse. Default is 0 */
        collapseDepth: 2,
        /* Which headings to grab inside of the contentSelector element. */
        headingSelector: 'h1, h2, h3, h4',
      });

      /* Track scrolling to show/hide the tocbot navigation bar on right side */
      var onScrollHandler = function (event) {

        /* End event listener after visitor scrolls past 500px */
        if (window.pageYOffset > 500) {
          window.removeEventListener('scroll', onScrollHandler, false);
          document.getElementById("tocbot-toc").style.visibility = "visible";
        }
        /* console.log("window scroll event:", window.pageYOffset); */
      };

      /* Listen for scroll events */
      window.addEventListener('scroll', onScrollHandler, false);
    </script>
  {% endif %}

<!-- Theme Toggle Button Injection -->
<script>
  (function() {
    // Fonction pour initialiser le thème toggle
    function initThemeToggle() {
      const pageHeader = document.querySelector('.page-header');
      
      // Créer et injecter le bouton
      if (pageHeader && !document.getElementById('theme-toggle')) {
        const themeButton = document.createElement('button');
        themeButton.id = 'theme-toggle';
        themeButton.className = 'btn-theme-toggle';
        themeButton.setAttribute('aria-label', 'Toggle dark mode');
        themeButton.setAttribute('title', 'Toggle dark/light theme');
        
        themeButton.innerHTML = `
          <svg class="icon icon-sun" viewBox="0 0 24 24" aria-hidden="true" width="18" height="18">
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
            <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
            <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
          </svg>
          <svg class="icon icon-moon" viewBox="0 0 24 24" aria-hidden="true" width="18" height="18">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="1.5" fill="none"/>
          </svg>
        `;
        
        pageHeader.appendChild(themeButton);
      }
      
      // Ajouter l'écouteur de clic au bouton
      const toggleBtn = document.getElementById('theme-toggle');
      if (toggleBtn && !toggleBtn.hasListener) {
        toggleBtn.addEventListener('click', function(e) {
          e.preventDefault();
          const currentTheme = localStorage.getItem('theme') || 'dark';
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          // Sauvegarder et appliquer le nouveau thème
          localStorage.setItem('theme', newTheme);
          
          // Ajouter la classe au documentElement
          if (newTheme === 'dark') {
            document.documentElement.classList.add('dark-mode');
            document.documentElement.classList.remove('light-mode');
          } else {
            document.documentElement.classList.add('light-mode');
            document.documentElement.classList.remove('dark-mode');
          }
          
          // Mettre à jour l'attribut data-theme
          document.documentElement.setAttribute('data-theme', newTheme);
        });
        toggleBtn.hasListener = true; // Marquer pour éviter les doublons
      }
    }
    
    // Initialiser au chargement du DOM
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initThemeToggle);
    } else {
      // Si le DOM est déjà chargé
      initThemeToggle();
    }
  })();
</script>
